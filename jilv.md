## 第二圈逻辑

### 惯性导航

​	对于微缩光电来说，惯性导航运用的方式是，第一圈记录记录赛道信息，第二圈自动行驶。这涉及到路径的记录与回放，所以惯性导航中的航位角推算法是核心。惯性导航的核心的陀螺仪测量角速度，积分得到角度变化，结合编码器的位置信息，通过航位推算法估算车辆的位置和方向。(但是要考虑积分误差的累积)。
​	所以就是，在路径记录阶段实时采集编码器的脉冲数来计算行驶的距离，同时用陀螺仪积分得到转向角度，从而记录车辆轨迹。在第二圈的回放阶段，根据记录轨迹，通过 PID 控制等方式调整小车速度和方向，使其按照预定路径行驶。

在这个思路中一共涉及到的有:

1. 惯性导航基本原理知识，**航位推算法**的应用 

2. **编码器数据处理:脉冲计数转成距离，方向处理**
3.  **陀螺仪数据处理:角速度积分转成角度，校准方法**
4. 数据融合方法:互补滤波或卡尔曼滤波的应用
5. 路径记录与回放的实现步骤
6. 控制策略:PID 调整转向和速度
7. 一些误差的解决:积分误差，传感器噪声
8. 编程注意：



### 1. 编码器位移计算

左轮位移增量：
$$
Δd_L=\frac{2πr}{N}×Δcount_L
$$
右轮位移增量：
$$
Δd_R=\frac{2πr}{N}×Δcount_R
$$

### 2. 位置与航向更新

航向角更新：
$$
θ_{k+1}=θ_k+Δθ
$$
X 坐标更新：
$$
X_{k+1}=X_k+Δd×cos⁡(θ_k)
$$
Y 坐标更新：
$$
Y_{k+1}=Y_k+Δd×sin⁡(θ_k)
$$
中心位移：
$$
Δd=\frac{ΔdL+ΔdR}{2}
$$


航向角更新（重复定义）：
$$
θ_{k}=θ_{k-1}+Δθ
$$


X 坐标更新（重复定义）：
$$
X_{k}=X_{k-1}+Δd×cos⁡(θ_k)
$$
Y 坐标更新（重复定义）：
$$
Y_{k}=Y_{k-1}+Δd×sin⁡(θ_k)
$$


位移增量（另一种表达）：
$$
Δd_L=\frac{2πr}{N}×ΔP
$$


航向角（基于角速度）：
$$
θ_k=θ_{k−1}+ω_z×Δt
$$
X 坐标更新（基于速度）：
$$
X_{k+1}= X_k+V_kΔtcosθ_k+\frac{1}{2}a_{x,k}Δt^2
$$
Y 坐标更新（基于速度）：
$$
Y_{k+1}= Y_k+V_yΔtcosθ_k+\frac{1}{2}a_{y,k}Δt^2
$$
数据：

- ΔcountL ,ΔcountR：左右编码器采样周期脉冲变化量
- X：坐标更新（X 轴）
- Y：坐标更新（Y 轴）
- r：车轮半径
- N：编码器每圈线数（如 1024）
- ΔP：脉冲变化总和
- ωk：角速度

我们基于这些核心公式，我们便可以开始完成代码编写:

encoder：编码器：

imu

## 航位推算法

左轮位移增量：
$$
Δd_L=\frac{2πr}{N}×Δcount_L
$$
右轮位移增量：
$$
Δd_R=\frac{2πr}{N}×Δcount_R
$$
航向角（基于角速度）：
$$
θ_k=θ_{k−1}+ω_z×Δt
$$
中心位移：
$$
Δd=\frac{ΔdL+ΔdR}{2}
$$
X 坐标更新（重复定义）：
$$
X_{k}=X_{k-1}+Δd×cos⁡(θ_k)
$$
Y 坐标更新（重复定义）：
$$
Y_{k}=Y_{k-1}+Δd×sin⁡(θ_k)
$$
有这些公式推导得出：

